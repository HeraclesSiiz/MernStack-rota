"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[312],{5312:function(e,t,n){n.r(t);var a=n(2982),r=n(7762),l=n(1413),o=n(5671),i=n(3144),s=n(136),c=n(3668),u=n(2791),p=n(8687),v=n(3513),h=n(6367),d=n(8472),f=n(4373),g=n(8970),m=n(4845),b=n(184),y=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var a;(0,o.Z)(this,n),(a=t.call(this,e)).onChangeYear=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selYear:e.target.value}))},a.levelModalChange=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selLevel:e.target.value}))},a.onChangeMonth=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selMonth:e.target.value}))},a.viewPerPatient=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{perPatient:!a.state.perPatient}))};var r=new Date,i=r.getFullYear(),s=r.getMonth()+1>9?r.getMonth()+1:"0"+(r.getMonth()+1);return a.state={selYear:i,selMonth:s,perPatient:!1},a}return(0,i.Z)(n,[{key:"getTotals",value:function(e,t){var n=0;return e.forEach((function(e){n+=e[t]})),n}},{key:"getPercentage",value:function(e){var t=0;return e.netProfit>0&&(t=e.netProfit/e.revenue*100),e.percentage=t.toFixed(2)+"%",e.percentage}},{key:"swap",value:function(e){var t=[];for(var n in e)t[e[n]]=n;return t}},{key:"render",value:function(){var e=this,t=this.state,n=t.selYear,l=t.selMonth,o=t.perPatient,i=this.props.basic,s=this.props.basic.user;s.role||0!==s.role||(m.Z.push("/"),m.Z.go("/"));var c=i.monthNames,u=this.swap(c),p=Object.keys(c),y=Object.values(c),k=p.map((function(e,t){return(0,b.jsx)("option",{value:y[t],children:e},t)})),w=[],Z=[];o?w.push({name:"Patient",center:!0,wrap:!0,sortable:!0,filterable:!0,selector:function(e){return e.patient}},{name:"Level",center:!0,wrap:!0,sortable:!0,selector:function(e){return e.level}}):w.push({name:"Month",center:!0,wrap:!0,selector:function(e){return e.month}}),w.push({name:"Revenue",center:!0,wrap:!0,selector:function(e){return e.revenue?e.revenue.toLocaleString("en"):0}},{name:"Payroll",center:!0,wrap:!0,selector:function(e){return e.payroll?e.payroll.toLocaleString("en"):0}},{name:"Profit/Loss",center:!0,wrap:!0,selector:function(e){return e.pnl?e.pnl.toLocaleString("en"):0}},{name:"Percentage",center:!0,wrap:!0,selector:function(e){return e.percentage?e.percentage.toLocaleString("en"):0}});var P=i.holidays,x=[];P.map((function(e){var t=u[e.slice(0,2)];void 0==x[t]&&(x[t]=[]),x[t].push(n+"-"+e)}));var j=[];for(var I in u)for(var _=new Date(n,I,0).getDate(),C=new Date(n+"-"+I+"-01").getDay(),D=C=0==C?1:7-C+1;D<_;D+=7){var S=D>9?D:"0"+D,M=u[I];void 0==j[M]&&(j[M]=[]),j[M].push(n+"-"+I+"-"+S)}var L=[],T=[],F=[],N=[];if(i.nurses.map((function(e){var t,o=e.basic_allowances+e.housing_allowances+e.other_allowances,i=e.leave?e.leave:[],s=[],p=(0,r.Z)(i);try{for(p.s();!(t=p.n()).done;)for(var v=t.value,h=new Date(v.from),d=new Date(v.to),f=h;f<=d;){var g=f.getFullYear(),m=f.getMonth()+1>9?f.getMonth()+1:"0"+(f.getMonth()+1),b=f.getDate()>9?f.getDate():"0"+f.getDate();if(g==n){var y=u[m];void 0==s[y]&&(s[y]=[]),s[y].push(g+"-"+m+"-"+b)}f.setDate(f.getDate()+1)}}catch(R){p.e(R)}finally{p.f()}var k=e.rota,w=[],Z=[];k.map((function(t){if(t.date.startsWith(n)){var a=u[[t.date.slice(5,7)]];void 0==w[a]?w[a]=t.hour:w[a]+=t.hour,x[a]&&x[a].includes(t.date)&&(void 0==Z[a]?Z[a]=t.hour:Z[a]+=t.hour),t.date.slice(5,7)==l&&(void 0==T[t.patient_id]&&(T[t.patient_id]=[]),void 0==T[t.patient_id][e._id]?T[t.patient_id][e._id]=t.hour:T[t.patient_id][e._id]+=t.hour)}}));var P=[],I=[];for(var _ in c){var C=new Date(n,c[_],0).getDate();if(void 0==s[_]&&(s[_]=[]),void 0==x[_]&&(x[_]=[]),void 0==j[_]&&(j[_]=[]),P[_]=[].concat((0,a.Z)(s[_]),(0,a.Z)(x[_]),(0,a.Z)(j[_])),P[_]=(0,a.Z)(new Set(P[_])),I[_]=8*(C-P[_].length),void 0==w[_]&&(w[_]=0),void 0==Z[_]&&(Z[_]=0),void 0==L[_]&&(L[_]=0),w[_]){var D=parseFloat(15*e.basic_allowances/365/8),S=parseFloat(18*e.basic_allowances/365/8),M=parseFloat(12*o/365);if(I[_]<w[_]){var N=w[_]-I[_],Y=0;void 0!=Z[_]&&(N<=Z[_]?(Y=N,N=0):(N-=Z[_],Y=Z[_])),o+=parseInt(D*N+S*Y)}if(n==parseInt(e.date.slice(0,4))){var O=e.date;c[_]<O.slice(5,7)?o=0:c[_]==O.slice(5,7)&&(o-=parseInt(M*(parseInt(O.slice(8,10))-1)))}else n<parseInt(e.date.slice(0,4))&&(o=0);L[_]+=o,c[_]==l&&(F[e._id]=parseFloat(o/w[_]))}}})),o){var Y=0,O=0;i.patients.map((function(e){var t=0,a=0;for(var r in N=[{label:"Patient",key:"patient"},{label:"Level",key:"level"},{label:"Revenue",key:"revenue"},{label:"Payroll",key:"payroll"},{label:"Profit/Loss",key:"pnl"},{label:"Prcentage",key:"percentage"}],e.revenue)r.slice(4,6)==n%100&&c[r.slice(0,3)]==l&&(t=e.revenue[r],Y+=t);if(void 0==T[e._id])a=0;else{for(var o in T[e._id])a+=parseFloat(T[e._id][o]*F[o]);O+=a}Z.push({patient:e.name,level:e.level,revenue:parseInt(t),payroll:parseInt(a),pnl:t-parseInt(a),percentage:parseInt((t-parseInt(a))/parseInt(t)*100)+"%"})}));var R={patient:" Total",revenue:Y,payroll:parseInt(O),pnl:Y-parseInt(O),percentage:parseInt((Y-parseInt(O))/Y*100)+"%"};Z.push(R)}else{N=[{label:"Month",key:"month"},{label:"Revenue",key:"revenue"},{label:"Payroll",key:"payroll"},{label:"Profit/Loss",key:"pnl"},{label:"Prcentage",key:"percentage"}];var K=[];for(var H in i.patients.map((function(e){for(var t in e.revenue)if(t.slice(4,6)==n%100){var a=t.slice(0,3);void 0==K[a]?K[a]=e.revenue[t]:K[a]+=e.revenue[t]}})),c)void 0==K[H]&&(K[H]=0),void 0==L[H]&&(L[H]=0),Z.push({month:H,revenue:K[H],payroll:L[H],pnl:K[H]-L[H],percentage:parseInt((K[H]-L[H])/K[H]*100)+"%"});var E={};K=Object.values(K).reduce((function(e,t){return e+t}),0);var G=Object.values(L).reduce((function(e,t){return e+t}),0),V=K-G;E.month="Total",E.revenue=K,E.payroll=G,E.pnl=V,E.percentage=parseInt(V/K*100)+"%",Z.push(E)}return(0,b.jsxs)(h.L5,{children:[(0,b.jsx)("div",{className:"pt-5 text-center text-dark",children:(0,b.jsx)("h1",{className:"mt-3",children:"PROFIT & LOSS"})}),(0,b.jsxs)(h.uZ,{className:" align-items-center justify-content-center",children:[(0,b.jsx)(h.TK,{md:"2",children:(0,b.jsx)(g.Z.Group,{children:(0,b.jsx)(g.Z.Control,{type:"number",value:n,placeholder:"Year",onChange:function(t){return e.onChangeYear(t)}})})}),o&&(0,b.jsx)(h.TK,{md:"2",children:(0,b.jsx)(g.Z.Group,{children:(0,b.jsx)(g.Z.Select,{"aria-label":"select",value:l,onChange:function(t){return e.onChangeMonth(t)},children:k})})}),(0,b.jsx)(h.TK,{md:"2",className:"pt-3",children:(0,b.jsx)(g.Z.Check,{checked:o,type:"checkbox",isValid:!0,label:"Per Patient",onChange:function(t){return e.viewPerPatient(t)}})}),(0,b.jsx)(h.TK,{md:"2",className:"float-right",children:(0,b.jsxs)(d.CSVLink,{headers:N,data:Z,filename:"pnl.csv",className:"btn btn-success ",target:"_blank",children:[(0,b.jsx)(f.Cb8,{}),"Export"]})})]}),(0,b.jsx)(h.uZ,{className:"mt-2",children:(0,b.jsx)(v.ZP,{columns:w,data:Z,filter:!0,fixedHeader:!0,striped:!0,conditionalRowStyles:[{when:function(e){return"Total"==e.month||"Total"==e.patient},style:function(e){return{backgroundColor:"rgb(160,160,160)"}}}],fixedHeaderScrollHeight:"60vh"})})]})}}]),n}(u.Component);t.default=(0,p.$j)((function(e){return{basic:e.BasicData}}),null)(y)}}]);
//# sourceMappingURL=312.4a7e078e.chunk.js.map