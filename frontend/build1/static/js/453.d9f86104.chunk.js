"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[453],{4453:function(e,t,n){n.r(t);var a=n(4942),r=n(1413),s=n(5671),l=n(3144),o=n(136),i=n(3668),u=n(2791),c=(n(4278),n(4569)),d=n.n(c),h=n(8687),v=n(3513),m=n(6367),p=n(8472),f=n(4373),y=n(8970),x=n(2248),j=n(6355),_=n(5828),g=n.n(_),Z=(n(2831),n(8492)),b=n.n(Z),w=n(7392),C=n(184),k=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){var l;(0,s.Z)(this,n),(l=t.call(this,e)).setDate=function(e,t){l.setState((0,r.Z)((0,r.Z)({},l.state),{},(0,a.Z)({},e,t.target.value)))},l.setModalDate=function(e,t){l.setState((0,r.Z)((0,r.Z)({},l.state),{},{modal:(0,r.Z)((0,r.Z)({},l.state.modal),{},(0,a.Z)({},e,t.target.value))}))},l.filterChange=function(e){l.setState((0,r.Z)((0,r.Z)({},l.state),{},{selFilter:e.target.value}))},l.onChangeNurse=function(e){l.setState((0,r.Z)((0,r.Z)({},l.state),{},{selNurse:0,selNurseValue:e.target.value}))},l.OnSelectNurse=function(e,t){l.setState((0,r.Z)((0,r.Z)({},l.state),{},{selNurse:t.key,selNurseValue:e}))},l.onChangeType=function(e){l.setState((0,r.Z)((0,r.Z)({},l.state),{},{selType:e.target.value}))},l.onChangeView=function(e,t){l.setState((0,r.Z)((0,r.Z)({},l.state),{},(0,a.Z)({},e,t.target.value)))},l.addLeave=function(){var e=l.state,t=e.selNurse,n=e.selType,a=e.from,r=e.to;if(0==t)g().info("Please select nurse!");else{l.setState({selNurse:0});var s=l.props.basic.requestblocks;if(s.includes(t)||s.includes("roaster"))return g().clear(),void setTimeout((function(){return g().warning("This item cannot be requested! Please wait until approver approve the transfer request.")}),300);d().post("leave/add",{nurse_id:t,type:n,from:a,to:r}).then((function(e){"error"==e.data.state&&(g().clear(),setTimeout((function(){return g().info("holiday setting error!")}),3e3))})).catch((function(e){}))}},l.leaveModal=function(e,t){e?l.setState((0,r.Z)((0,r.Z)({},l.state),{},{isOpen:e,modal:{nurse_id:t.nurse_id,leave_id:t.leave_id,type:t.type,from:t.leave_start,to:t.leave_end}})):l.setState((0,r.Z)((0,r.Z)({},l.state),{},{isOpen:e}))},l.editConfirmLeave=function(){l.setState({isOpen:!1});var e=l.props.basic.requestblocks;if(e.includes(l.state.modal.nurse_id)||e.includes("roaster"))return g().clear(),void setTimeout((function(){return g().warning("This item cannot be requested! Please wait until approver approve the transfer request.")}),300);d().post("leave/edit",(0,r.Z)({},l.state.modal)).then((function(e){"error"==e.data.state&&(g().clear(),setTimeout((function(){return g().info("holiday setting error!")}),3e3))})).catch((function(e){}))},l.removeLeave=function(e){var t=l.props.basic.requestblocks;if(t.includes(e.nurse_id)||t.includes("roaster"))return g().clear(),void setTimeout((function(){return g().warning("This item cannot be requested! Please wait until approver approve the transfer request.")}),300);d().post("leave/remove",{nurse_id:e.nurse_id,leave_id:e.leave_id}).then((function(e){"error"==e.data.state&&(g().clear(),setTimeout((function(){return g().info("holiday setting error!")}),3e3))})).catch((function(e){}))};var o=new Date,i=o.getFullYear(),u=o.getMonth()+1>9?o.getMonth()+1:"0"+(o.getMonth()+1),c=o.getDate()>9?o.getDate():"0"+o.getDate();return l.state={selView:1,selYear:i,selMonth:u,from:i+"-"+u+"-"+c,to:i+"-"+u+"-"+c,selFilter:"",selNurse:0,selNurseValue:"",selType:0,isOpen:!1,modal:{nurse_id:"",leave_id:"",type:"",from:"",to:""}},l}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){}},{key:"getLeaveType",value:function(e){return 1==e.type?e.leave_type="Annual Leave":2==e.type?e.leave_type="Sick Leave":3==e.type?e.leave_type="Maternity leave":4==e.type&&(e.leave_type="Other Leave"),e.leave_type}},{key:"render",value:function(){var e=this,t=this.state,n=t.from,a=t.to,r=(t.selNurse,t.selNurseValue),s=t.selType,l=t.modal,o=t.isOpen,i=t.selView,u=t.selYear,c=t.selMonth,d=(t.selFilter,this.props.basic),h=this.props.basic.user,_=[];_.push({name:"No",center:!0,wrap:!0,selector:function(e){return e.no}},{name:"Image",center:!0,wrap:!0,width:"70px",cell:function(e){return(0,C.jsx)("img",{src:e.image,style:{width:"65px",height:"50px"}})}},{name:"Staff ID",center:!0,wrap:!0,selector:function(e){return e.nurse_short_id}},{name:"Staff Name",center:!0,selector:function(e){return e.name}}),1==i?_.push({name:"Leave Type",center:!0,selector:function(e){return e.leave_type}},{name:"Leave Start",center:!0,wrap:!0,selector:function(e){return e.leave_start}},{name:"Leave End",center:!0,selector:function(e){return e.leave_end}}):_.push({name:"Leave Periods",center:!0,wrap:!0,width:"300px",selector:function(e){return e.leave_periods}}),_.push({name:"Leave Days",center:!0,wrap:!0,selector:function(e){return e.leave_days}},{name:"Daily Hours",center:!0,wrap:!0,selector:function(e){return e.daily_hours}},{name:"Leave Hours",center:!0,wrap:!0,selector:function(e){return e.leave_hours}}),1==i&&h.hasOwnProperty("role")&&1!==h.role&&_.push({name:"Action",center:!0,wrap:!0,cell:function(t){return[(0,C.jsxs)(m.Ff,{children:[(0,C.jsx)(m.$v,{outline:!0,color:"success",size:"sm",className:"my-1 ms-1",onClick:function(){return e.leaveModal(!0,t)},children:(0,C.jsx)(j.fmQ,{})}),(0,C.jsx)(m.$v,{outline:!0,color:"success",size:"sm",className:"my-1 me-1",onClick:function(){return e.removeLeave(t)},children:(0,C.jsx)(j.Xm5,{})})]},t.leave_id)]}});var g=[],Z=[];d.nurses.map((function(e){g[e._id]=e.name,e.name.includes(r)&&Z.push({label:e.name,key:e._id})}));var w=[],k=0;d.nurses.map((function(t){var n=0,a=[];t.leave.map((function(r){var s=u+"-"+c,l=new Date(u,c,0).getDate();if(r.from.startsWith(s)||r.to.startsWith(s)){var o=new Date(r.from),d=new Date(r.to),h=Math.ceil((d-o)/864e5)+1;2==i&&(r.from.startsWith(s)?r.to.startsWith(s)?a.push("("+parseInt(r.from.slice(8))+"~"+parseInt(r.to.slice(8))+")"):(h=Math.ceil((new Date(u+"-"+c+"-"+l)-o)/864e5)+1,a.push("("+parseInt(r.from.slice(8))+"~"+l+")")):(h=parseInt(r.to.slice(8,10)),a.push("(1~"+parseInt(r.to.slice(8))+")")),n+=h),1==i&&(k++,w.push({no:k,image:t.image,nurse_id:t._id,nurse_short_id:t._id.slice(20),name:t.name,leave_type:e.getLeaveType(r),leave_id:r.leave_id,leave_start:r.from,leave_end:r.to,leave_days:h,daily_hours:8,leave_hours:8*h}))}})),2==i&&0!=n&&(k++,w.push({no:k,image:t.image,nurse_id:t._id,nurse_short_id:t._id.slice(20),name:t.name,leave_periods:a.join(","),leave_days:n,daily_hours:8,leave_hours:8*n}))}));var N=d.monthNames,S=Object.keys(N),T=Object.values(N),L=S.map((function(e,t){return(0,C.jsx)("option",{value:T[t],children:e},t)}));return w.sort((function(e,t){return e.name>t.name?1:t.name>e.name?-1:0})),(0,C.jsxs)(m.L5,{children:[(0,C.jsx)("div",{className:"pt-5 text-center text-dark",children:(0,C.jsx)("h1",{className:"mt-3",children:"LEAVE DAYS"})}),h.hasOwnProperty("role")&&1!==h.role&&(0,C.jsxs)(m.uZ,{className:" align-items-center justify-content-center ",children:[(0,C.jsx)(m.TK,{className:" autocomplete col-md-2 ncard",children:(0,C.jsx)(b(),{getItemValue:function(e){return e.label},items:Z,inputProps:{placeholder:"Select Nurses"},renderItem:function(e,t){return(0,C.jsx)("div",{style:{background:t?"#2E86C1":"white",color:t?"white":"black",borderRadius:"1px",backgroundColor:"white",fontSize:"15px",fontFamily:"Arial"},children:e.label})},value:r,onChange:function(t){return e.onChangeNurse(t)},onSelect:function(t,n){return e.OnSelectNurse(t,n)}})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Group,{children:(0,C.jsxs)(y.Z.Select,{"aria-label":"nurse select",value:s,onChange:function(t){return e.onChangeType(t)},children:[(0,C.jsx)("option",{value:"",children:"Select Leave"}),(0,C.jsx)("option",{value:"1",children:"Annual leave"}),(0,C.jsx)("option",{value:"2",children:"sick leave"}),(0,C.jsx)("option",{value:"3",children:"Maternity leave"}),(0,C.jsx)("option",{value:"4",children:"Other Leave"})]})})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Group,{children:(0,C.jsx)(y.Z.Control,{type:"date",value:n,max:a,onChange:function(t){return e.setDate("from",t)}})})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Group,{children:(0,C.jsx)(y.Z.Control,{type:"date",value:a,min:n,onChange:function(t){return e.setDate("to",t)}})})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(m.$v,{outline:!0,rounded:!0,color:"success",onClick:function(){return e.addLeave()},children:"Add Leave"})})]}),(0,C.jsxs)(m.uZ,{className:"mt-3 align-items-center justify-content-center",children:[(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Group,{children:(0,C.jsxs)(y.Z.Select,{"aria-label":"nurse select",value:i,onChange:function(t){return e.onChangeView("selView",t)},children:[(0,C.jsx)("option",{value:"1",children:"View Per Record"}),(0,C.jsx)("option",{value:"2",children:"View Per Nurse"})]})})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Group,{children:(0,C.jsx)(y.Z.Control,{type:"number",value:u,min:2e3,onChange:function(t){return e.onChangeView("selYear",t)}})})}),(0,C.jsx)(m.TK,{md:"2",children:(0,C.jsx)(y.Z.Select,{"aria-label":"select",value:c,onChange:function(t){return e.onChangeView("selMonth",t)},children:L})}),(0,C.jsx)(m.TK,{md:"3",className:"float-right",children:(0,C.jsxs)(p.CSVLink,{headers:[{label:"No",key:"no"},{label:"Staff ID",key:"nurse_short_id"},{label:"Staff Name",key:"name"},{label:"Leave Type",key:"leave_type"},{label:"Leave Start",key:"leave_start"},{label:"Leave End",key:"leave_end"},{label:"Leave Days",key:"leave_days"},{label:"Daily Hours",key:"daily_hours"},{label:"Leave Hours",key:"leave_hours"}],data:w,filename:"leavedays.csv",className:"btn btn-success ",target:"_blank",children:[(0,C.jsx)(f.Cb8,{}),"Export"]})})]}),(0,C.jsx)(m.uZ,{className:"mt-2",children:(0,C.jsx)(v.ZP,{columns:_,data:w,fixedHeader:!0,fixedHeaderScrollHeight:"60vh"})}),(0,C.jsxs)(x.Z,{show:o,size:"sm","aria-labelledby":"contained-modal-title-vcenter",centered:!0,onHide:function(){return e.leaveModal(!1)},children:[(0,C.jsx)(x.Z.Header,{closeButton:!0,children:(0,C.jsx)(x.Z.Title,{children:"Leave Modify"})}),(0,C.jsxs)(x.Z.Body,{children:[(0,C.jsx)(m.uZ,{children:(0,C.jsx)(m.TK,{children:(0,C.jsx)(y.Z.Control,{type:"date",value:l.from,max:l.to,onChange:function(t){return e.setModalDate("from",t)}})})}),(0,C.jsx)(m.uZ,{className:"mt-2",children:(0,C.jsx)(m.TK,{children:(0,C.jsx)(y.Z.Control,{type:"date",value:l.to,min:l.from,onChange:function(t){return e.setModalDate("to",t)}})})})]}),(0,C.jsxs)(x.Z.Footer,{children:[(0,C.jsx)(m.$v,{color:"secondary",onClick:function(){return e.leaveModal(!1)},children:"Close"}),(0,C.jsx)(m.$v,{color:"success",onClick:function(){return e.editConfirmLeave()},children:"Save"})]})]})]})}}]),n}(u.Component);t.default=(0,h.$j)((function(e){return{basic:e.BasicData}}),(function(e){return{getLeave:function(t){return e((0,w.ZY)(t))}}}))(k)}}]);
//# sourceMappingURL=453.d9f86104.chunk.js.map