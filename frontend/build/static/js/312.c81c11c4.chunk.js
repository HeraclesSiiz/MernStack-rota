"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[312],{5312:function(e,t,n){n.r(t);var a=n(2982),r=n(7762),l=n(1413),o=n(5671),i=n(3144),s=n(136),c=n(8505),u=n(2791),v=n(8687),p=n(3513),f=n(6367),d=n(6511),h=n(4373),g=n(8970),m=n(184),y=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var a;(0,o.Z)(this,n),(a=t.call(this,e)).onChangeYear=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selYear:e.target.value}))},a.levelModalChange=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selLevel:e.target.value}))},a.onChangeMonth=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{selMonth:e.target.value}))},a.viewPerPatient=function(e){a.setState((0,l.Z)((0,l.Z)({},a.state),{},{perPatient:!a.state.perPatient}))};var r=new Date,i=r.getFullYear(),s=r.getMonth()+1>9?r.getMonth()+1:"0"+(r.getMonth()+1);return a.state={selYear:i,selMonth:s,perPatient:!1},a}return(0,i.Z)(n,[{key:"getTotals",value:function(e,t){var n=0;return e.forEach((function(e){n+=e[t]})),n}},{key:"getPercentage",value:function(e){var t=0;return e.netProfit>0&&(t=e.netProfit/e.revenue*100),e.percentage=t.toFixed(2)+"%",e.percentage}},{key:"swap",value:function(e){var t=[];for(var n in e)t[e[n]]=n;return t}},{key:"render",value:function(){var e=this,t=this.state,n=t.selYear,l=t.selMonth,o=t.perPatient,i=(t.selLevel,this.props.basic),s=i.monthNames,c=this.swap(s),u=Object.keys(s),v=Object.values(s),y=u.map((function(e,t){return(0,m.jsx)("option",{value:v[t],children:e})})),b=[],w=[];o?b.push({name:"Patient",center:!0,wrap:!0,sortable:!0,filterable:!0,selector:function(e){return e.patient}},{name:"Level",center:!0,wrap:!0,sortable:!0,selector:function(e){return e.level}}):b.push({name:"Month",center:!0,wrap:!0,selector:function(e){return e.month}}),b.push({name:"Revenue",center:!0,wrap:!0,selector:function(e){return e.revenue?e.revenue.toLocaleString("en"):0}},{name:"Payroll",center:!0,wrap:!0,selector:function(e){return e.payroll?e.payroll.toLocaleString("en"):0}},{name:"Profit/Loss",center:!0,wrap:!0,selector:function(e){return e.pnl?e.pnl.toLocaleString("en"):0}},{name:"Percentage",center:!0,wrap:!0,selector:function(t){return e.getPercentage(t)}});var Z=i.holidays,x=[];Z.map((function(e){var t=c[e.slice(0,2)];void 0==x[t]&&(x[t]=[]),x[t].push(n+"-"+e)}));var j=[];for(var k in c)for(var P=new Date(n,k,0).getDate(),_=new Date(n+"-"+k+"-01").getDay(),S=_=0==_?1:7-_+1;S<P;S+=7){var C=S>9?S:"0"+S,D=c[k];void 0==j[D]&&(j[D]=[]),j[D].push(n+"-"+k+"-"+C)}var M=[],I=[],L=[],T=[];if(i.nurses.map((function(e){var t,o=e.basic_allowances+e.housing_allowances+e.other_allowances,i=e.leave?e.leave:[],u=[],v=(0,r.Z)(i);try{for(v.s();!(t=v.n()).done;)for(var p=t.value,f=new Date(p.from),d=new Date(p.to),h=f;h<=d;){var g=h.getFullYear(),m=h.getMonth()+1>9?h.getMonth()+1:"0"+(h.getMonth()+1),y=h.getDate()>9?h.getDate():"0"+h.getDate();if(g==n){var b=c[m];void 0==u[b]&&(u[b]=[]),u[b].push(g+"-"+m+"-"+y)}h.setDate(h.getDate()+1)}}catch(R){v.e(R)}finally{v.f()}var w=e.rota,Z=[],k=[];w.map((function(t){if(t.date.startsWith(n)){var a=c[[t.date.slice(5,7)]];void 0==Z[a]?Z[a]=t.hour:Z[a]+=t.hour,x[a]&&x[a].includes(t.date)&&(void 0==k[a]?k[a]=t.hour:k[a]+=t.hour),t.date.slice(5,7)==l&&(void 0==I[t.patient_id]&&(I[t.patient_id]=[]),void 0==I[t.patient_id][e._id]?I[t.patient_id][e._id]=t.hour:I[t.patient_id][e._id]+=t.hour)}}));var P=[],_=[];for(var S in s){var C=new Date(n,s[S],0).getDate();if(void 0==u[S]&&(u[S]=[]),void 0==x[S]&&(x[S]=[]),void 0==j[S]&&(j[S]=[]),P[S]=[].concat((0,a.Z)(u[S]),(0,a.Z)(x[S]),(0,a.Z)(j[S])),P[S]=(0,a.Z)(new Set(P[S])),_[S]=8*(C-P[S].length),void 0==Z[S]&&(Z[S]=0),void 0==k[S]&&(k[S]=0),void 0==M[S]&&(M[S]=0),Z[S]){var D=parseFloat(15*e.basic_allowances/365/8),T=parseFloat(18*e.basic_allowances/365/8),F=parseFloat(12*o/365);if(_[S]<Z[S]){var N=Z[S]-_[S],Y=0;void 0!=k[S]&&(N<=k[S]?(Y=N,N=0):(N-=k[S],Y=k[S])),o+=parseInt(D*N+T*Y)}if(n==parseInt(e.date.slice(0,4))){var O=e.date;s[S]<O.slice(5,7)?o=0:s[S]==O.slice(5,7)&&(o-=parseInt(F*(parseInt(O.slice(8,10))-1)))}else n<parseInt(e.date.slice(0,4))&&(o=0);M[S]+=o,s[S]==l&&(L[e._id]=parseFloat(o/Z[S]))}}})),o){var F=0,N=0;i.patients.map((function(e){var t=0,a=0;for(var r in T=[{label:"Patient",key:"patient"},{label:"Level",key:"level"},{label:"Revenue",key:"revenue"},{label:"Payroll",key:"payroll"},{label:"Profit/Loss",key:"pnl"}],e.revenue)r.slice(4,6)==n%100&&s[r.slice(0,3)]==l&&(t=e.revenue[r],F+=t);if(void 0==I[e._id])a=0;else{for(var o in I[e._id])a+=parseFloat(I[e._id][o]*L[o]);N+=a}w.push({patient:e.name,level:e.level,revenue:parseInt(t),payroll:parseInt(a),pnl:t-parseInt(a)})}));var Y={patient:" Total",revenue:F,payroll:parseInt(N),pnl:F-parseInt(N)};w.push(Y)}else{T=[{label:"Month",key:"month"},{label:"Revenue",key:"revenue"},{label:"Payroll",key:"payroll"},{label:"Profit/Loss",key:"pnl"}];var O=[];for(var R in i.patients.map((function(e){for(var t in e.revenue)if(t.slice(4,6)==n%100){var a=t.slice(0,3);void 0==O[a]?O[a]=e.revenue[t]:O[a]+=e.revenue[t]}})),s)void 0==O[R]&&(O[R]=0),void 0==M[R]&&(M[R]=0),w.push({month:R,revenue:O[R],payroll:M[R],pnl:O[R]-M[R]});var K={};O=Object.values(O).reduce((function(e,t){return e+t}),0);var E=Object.values(M).reduce((function(e,t){return e+t}),0),H=O-E;K.month="Total",K.revenue=O,K.payroll=E,K.pnl=H,w.push(K)}return(0,m.jsxs)(f.L5,{children:[(0,m.jsx)("div",{className:"pt-5 text-center text-dark",children:(0,m.jsx)("h1",{className:"mt-3",children:"PROFIT & LOSS"})}),(0,m.jsxs)(f.uZ,{className:" align-items-center justify-content-center",children:[(0,m.jsx)(f.TK,{md:"2",children:(0,m.jsx)(g.Z.Group,{children:(0,m.jsx)(g.Z.Control,{type:"number",value:n,placeholder:"Year",onChange:function(t){return e.onChangeYear(t)}})})}),o&&(0,m.jsx)(f.TK,{md:"2",children:(0,m.jsx)(g.Z.Group,{children:(0,m.jsx)(g.Z.Select,{"aria-label":"select",value:l,onChange:function(t){return e.onChangeMonth(t)},children:y})})}),(0,m.jsx)(f.TK,{md:"2",className:"pt-3",children:(0,m.jsx)(g.Z.Check,{checked:o,type:"checkbox",isValid:!0,label:"Per Patient",onChange:function(t){return e.viewPerPatient(t)}})}),(0,m.jsx)(f.TK,{md:"2",className:"float-right",children:(0,m.jsxs)(d.CSVLink,{headers:T,data:w,filename:"pnl.csv",className:"btn btn-success ",target:"_blank",children:[(0,m.jsx)(h.Cb8,{}),"Export"]})})]}),(0,m.jsx)(f.uZ,{className:"mt-2",children:(0,m.jsx)(p.ZP,{columns:b,data:w,filter:!0,fixedHeader:!0,striped:!0,conditionalRowStyles:[{when:function(e){return"Total"==e.month||"Total"==e.patient},style:function(e){return{backgroundColor:"rgb(160,160,160)"}}}],fixedHeaderScrollHeight:"60vh"})})]})}}]),n}(u.Component);t.default=(0,v.$j)((function(e){return{basic:e.BasicData}}),null)(y)},7762:function(e,t,n){n.d(t,{Z:function(){return r}});var a=n(181);function r(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,a.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}}}]);
//# sourceMappingURL=312.c81c11c4.chunk.js.map